<!DOCTYPE html>
<html lang="en">

<head>
	<title>{% block title %}{% endblock title %} | ShopEase</title>
	<meta charset="utf-8" />
	{% load static %}
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

	<link href="{% static 'images/iconSmall.png' %}" rel="Assassin's Home" />
	<link rel="shortcut icon" type="image/jpg" href="{% static 'images/iconSmall.png' %}" />

	<link href="https://fonts.googleapis.com/css?family=Rubik:400,700" rel="stylesheet" />
	<link rel="stylesheet" href="{% static 'fonts/icomoon/style.css' %}" />

	{% comment %} "{{static('/appname/css/cssfilename.css')}}" {% endcomment %}
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
	<link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}" />
	<link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}" />
	<link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}" />
	<link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}" />

	{% comment %}
	<link rel="stylesheet" href="{% static 'css/aos.css' %}" />
	{% endcomment %}

	<link rel="stylesheet" href="{% static 'css/style.css' %}" />
	
	<style>
		/* Prevent content from overlapping with navbar */
		.site-navbar {
			position: relative;
			z-index: 1000;
		}
		
		/* Add spacing after navbar for all pages */
		.content-wrapper {
			margin-top: 30px;
			min-height: 60vh;
		}
	</style>
</head>

<body>
	<div class="site-wrap">
		<div class="site-navbar bg-white py-2">
			<div class="search-wrap">
				<div class="container">
					<a href="#" class="search-close js-search-close"><span class="icon-close2"></span></a>
					<form onsubmit="objecturi()" name="search" method="post">
						{% csrf_token %}
						<input type="text" class="form-control" id="search"
							placeholder="Please Type the Cateogary...." />
						<script>
							function objecturi() {
								let searchObject = document.getElementById("search").value;
								let objj = "/search/" + searchObject;
								document.search.action = objj;
							}
						</script>
					</form>
				</div>
			</div>

			<div class="">
				<div class="container">
					<div class="d-flex align-items-center justify-content-between">
						<div class="logo">
							<div class="site-logo">
								<a href="/" class="js-logo-clone" style="font-weight: 700; font-size: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">ShopEase</a>
							</div>
						</div>
						<div class="main-nav d-none d-lg-block">
							<nav class="site-navigation text-right text-md-center" role="navigation">
								<ul class="site-menu js-clone-nav d-none d-lg-block">
									<li class="{{clas}}"><a href="/">Home</a></li>
									<li class="has-children {{style}}">
										<a href="#">Categories</a>
										<ul class="dropdown">
											<li><a href="/WebApplications/">Pottery & Ceramics</a></li>
											<li>
												<a href="/GraphicalApplications/">Jewelry & Accessories</a>
											</li>
											<li>
												<a href="/ConsoleApplications/">Textiles & Fabrics</a>
											</li>
										</ul>
									</li>

									<li class="{{shop}}"><a href="/shop">Shop All Items</a></li>
									<li class="{{cont}}"><a href="/contact">Contact</a></li>
									<li class="{{abou}}"><a href="/about">About</a></li>
								</ul>
							</nav>
						</div>
						<div class="icons">
							<a href="#" class="icons-btn d-inline-block js-search-open"><span
									class="icon-search"></span></a>
							<a href="#" class="icons-btn d-inline-block"><span class="icon-heart-o"></span></a>
							{% if not on_cart_page and not on_checkout_page %}
							<a href="/cart" class="icons-btn d-inline-block bag">
								<span class="icon-shopping-bag"></span>
								<span class="number" id="numb"></span>
							</a>
							{% endif %}
							
							{% if user.is_authenticated %}
							<!-- User Profile Dropdown -->
							<div class="user-profile-dropdown" style="display: inline-block; position: relative; margin-left: 15px;">
								<a href="#" class="icons-btn d-inline-block user-profile-btn" id="userProfileBtn" style="font-weight: 600; color: #000;">
									<span class="icon-user" style="margin-right: 5px;"></span>
									{{ user.username }}
								</a>
								<div class="dropdown-menu-custom" id="userDropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 10px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; z-index: 1000;">
									<div style="padding: 15px; border-bottom: 1px solid #f0f0f0;">
										<div style="font-weight: 600; color: #333;">{{ user.username }}</div>
										<div style="font-size: 0.85rem; color: #999;">{{ user.email }}</div>
									</div>
									<a href="/profile" style="display: block; padding: 12px 15px; color: #333; text-decoration: none; transition: background 0.2s;">
										<span class="icon-user" style="margin-right: 8px;"></span>My Profile
									</a>
									<a href="/my-products" style="display: block; padding: 12px 15px; color: #333; text-decoration: none; transition: background 0.2s;">
										<span class="icon-grid" style="margin-right: 8px;"></span>My Products
									</a>
									<a href="/list-product" style="display: block; padding: 12px 15px; color: #333; text-decoration: none; transition: background 0.2s;">
										<span class="icon-plus" style="margin-right: 8px;"></span>List New Product
									</a>
									<a href="/cart" style="display: block; padding: 12px 15px; color: #333; text-decoration: none; transition: background 0.2s;">
										<span class="icon-shopping-bag" style="margin-right: 8px;"></span>My Orders
									</a>
									<a href="#" style="display: block; padding: 12px 15px; color: #333; text-decoration: none; transition: background 0.2s;">
										<span class="icon-heart-o" style="margin-right: 8px;"></span>Wishlist
									</a>
									<a href="/logout" style="display: block; padding: 12px 15px; color: #d9534f; text-decoration: none; border-top: 1px solid #f0f0f0; transition: background 0.2s;">
										<span class="icon-sign-out" style="margin-right: 8px;"></span>Logout
									</a>
								</div>
							</div>
							<style>
								.dropdown-menu-custom a:hover {
									background: #f8f9fa;
								}
								.user-profile-btn {
									cursor: pointer;
								}
							</style>
							<script>
								document.addEventListener('DOMContentLoaded', function() {
									const userBtn = document.getElementById('userProfileBtn');
									const dropdown = document.getElementById('userDropdown');
									
									if (userBtn && dropdown) {
										userBtn.addEventListener('click', function(e) {
											e.preventDefault();
											dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
										});
										
										// Close dropdown when clicking outside
										document.addEventListener('click', function(e) {
											if (!userBtn.contains(e.target) && !dropdown.contains(e.target)) {
												dropdown.style.display = 'none';
											}
										});
									}
								});
							</script>
							{% else %}
							<!-- Login/Signup Buttons -->
							<a href="/login" class="btn btn-outline-primary btn-sm" style="margin-left: 15px; border-radius: 20px; padding: 8px 20px; font-weight: 600;">Login</a>
							<a href="/signup" class="btn btn-primary btn-sm" style="margin-left: 10px; border-radius: 20px; padding: 8px 20px; font-weight: 600;">Sign Up</a>
							{% endif %}
							
							<a href="#" class="site-menu-toggle js-menu-toggle ml-3 d-inline-block d-lg-none"><span
									class="icon-menu"></span></a>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="content-wrapper">
			{% block body %} {% endblock body %}
		</div>

		<footer class="site-footer custom-border-top">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
						<div class="block-7">
							<h3 class="footer-heading mb-4">About Us</h3>
							<p>
								We are trying to simplify the Mordern way of Purchasing Open
								Source Softwares where you can Just come and Get what you
								want.
							</p>
						</div>
						<div class="block-7">
							<form onclick="emailSubs()" name="emailSubs">
								<label for="email_subscribe" class="footer-heading">Subscribe</label>
								<div class="form-group">
									<input type="text" class="form-control py-4" id="email_subscribe"
										placeholder="Email" />
									<input type="submit" class="btn btn-sm btn-primary" value="Send" />
								</div>
							</form>
						</div>
					</div>
					<div class="col-lg-5 ml-auto mb-5 mb-lg-0" style="right: 42px">
						<div class="row">
							<div class="col-md-12">
								<h3 class="footer-heading mb-4">Quick Links</h3>
							</div>
							<div class="col-md-6 col-lg-4">
								<ul class="list-unstyled" style="margin-left: 2em">
									<li><a href="/WebApplications/">Pottery & Ceramics</a></li>
									<li>
										<a href="/GraphicalApplications/">Jewelry & Accessories</a>
									</li>
									<li>
										<a href="/ConsoleApplications/">Textiles & Fabrics</a>
									</li>
									<li><a href="/cart/">Cart</a></li>
								</ul>
							</div>
						</div>
					</div>

					<div class="col-md-6 col-lg-3">
						<div class="block-5 mb-5">
							<h3 class="footer-heading mb-4">Contact Info</h3>
							<ul class="list-unstyled">
								<li class="address">
									<a href="https://github.com/Dharmendra2567/Django-ecommerce-project"
										style="color: black">@jha-niraj</a>
										LPU, Jalandhar, Punjab
								</li>
								<li class="phone">
									<a href="https://wa.me/+918102841309">+91-8102841309</a>
								</li>
								<li class="email">
									<a href="mailto:dharmendrasahteli23@gmail.com"
										style="color: black">dharmendrasahteli23@gmail.com</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="row pt-5 mt-5 text-center">
					<div class="col-md-12">
						<p>
							Copyright &copy;
							<script>
								var date = new Date().getFullYear();
								var yesy = String(date) + " - " + String(date + 1);
								document.write(yesy);
							</script>
							All rights reserved | Made with
							<i class="icon-heart" aria-hidden="true"></i> by
							<a class="texttdecor" href="https://linktr.ee/coderaman07">Dharmendra Sah & Niraj Jha</a>
						</p>
					</div>
				</div>
			</div>
		</footer>
	</div>

	<script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
	<script src="{% static 'js/jquery-ui.js' %}"></script>
	<script src="{% static 'js/popper.min.js' %}"></script>
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
	<script src="{% static 'js/owl.carousel.min.js' %}"></script>
	<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
	<script src="{% static 'js/aos.js' %}"></script>
	<script src="{% static 'js/main.js' %}"></script>
	<script src="{% static 'js/script.js' %}"></script>

	<script>
		if (localStorage.getItem("cart") == null) {
			var cart = {};
		} else {
			cart = JSON.parse(localStorage.getItem("cart"));
		}

		$(".addtoCart").click(function (e) {
			e.preventDefault();
			e.stopPropagation();
			
			var idstring = this.id.toString();
			console.log("=== Adding to cart ===");
			console.log("Button ID:", idstring);
			
			if (cart[idstring] != undefined) {
				console.log("Item already in cart, incrementing quantity");
				qty = cart[idstring][0] + 1;
				cart[idstring][0] = qty;
			} else {
				qty = 1;
				var nameElement = document.getElementById("name" + idstring);
				var priceElement = document.getElementById("price" + idstring);
				
				console.log("Name element:", nameElement);
				console.log("Price element:", priceElement);
				
				if (nameElement && priceElement) {
					// Get name and clean up whitespace (tabs, newlines, extra spaces)
					name = nameElement.textContent.trim().replace(/\s+/g, ' ');
					console.log("Product name:", name);
					
					// Get price text and clean it
					var priceText = priceElement.textContent.trim();
					console.log("Raw price text:", priceText);
					
					// Extract price - handle multiple formats
					var price = priceText;
					if (priceText.includes(": ")) {
						price = priceText.split(": ")[1].trim();
					}
					
					// Validate price exists and has the rupee symbol
					if (!price || price === "" || price === "₹" || price === "₹0") {
						console.error("Invalid price detected:", price);
						alert("Error: Product price not available. Please refresh and try again.");
						return;
					}
					
					console.log("Final price:", price);
					cart[idstring] = [qty, name, price];
				} else {
					console.error("Could not find name or price element!");
					console.error("Looking for: name" + idstring + " and price" + idstring);
					alert("Error adding to cart. Please refresh the page and try again.");
					return;
				}
			}
			
			localStorage.setItem("cart", JSON.stringify(cart));
			console.log("Cart saved:", cart);
			console.log("===================");
			
			// Update button text
			this.innerHTML = "Added ✓";
			this.style.background = "linear-gradient(135deg, #10b981 0%, #059669 100%)";
			
			// Update cart counter immediately
			updateCartCounter();
			
			// Reset button after 2 seconds
			var button = this;
			setTimeout(function() {
				button.innerHTML = "Add to Cart";
				button.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
			}, 2000);
		});

		// Update cart counter
		function updateCartCounter() {
			var numbElement = document.getElementById("numb");
			if (!numbElement) return; // Exit if element doesn't exist yet
			
			if (localStorage.getItem("cart") == null || Object.keys(JSON.parse(localStorage.getItem("cart"))).length < 1) {
				numbElement.innerHTML = 0;
			} else {
				let cart = JSON.parse(localStorage.getItem("cart"));
				let count = Object.keys(cart).length;
				numbElement.innerHTML = count;
			}
		}
		
		// Update counter immediately when DOM is ready
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', updateCartCounter);
		} else {
			updateCartCounter();
		}
		
		// Update counter periodically
		setInterval(updateCartCounter, 1000);
	</script>
</body>

</html>